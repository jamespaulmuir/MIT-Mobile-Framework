.. _section-mobiweb-stellar

=======
Stellar
=======

-----------
Description
-----------

Mobile interface to browse through "Courses" (MIT terminology for
departments), class subjects, and viewing information about each
subject including time/location, instructors, description, and recent
announcements.  Allows users to bookmark shortcuts to subjects, which
are displayed under "My Stellar" on the Stellar main screen.

This module is the mobile counterpart to the Stellar course management
system, which is at http://stellar.mit.edu.

----------------------------
Data Sources / Configuration
----------------------------

^^^^^^^^^^^^^^^^^^^^^^^^^
MIT Course Listing System
^^^^^^^^^^^^^^^^^^^^^^^^^

MIT identifies departments either by a number (e.g. "Course 6" for
Electrical Engineering & Computer Science) or an acronym (e.g. "HST"
for Health Sciences and Technology).  All class subjects are
identified by the Course ID followed by a dot and the subject ID
(e.g. "6.00" is the first subject in Course 6).

All subjects have a primary ID (master ID in our terminology), but may
be cross-listed under several departments (e.g. "6.042 / 18.062J").
They may also be cross-listed with another subject within the same
department (e.g. "1.00 / 1.001").  Cross-listed subjects often end
with the letter "J" but not always.

Stellar also includes listings for Special Programs (identified with
"SP"), which are not official class subjects.

^^^^^^^^^^^
Stellar XML
^^^^^^^^^^^

Each Course has an associated XML file for each term. The URL of this
XML file for Course 6 in the Fall 2008 term, for example, is
http://stellar.mit.edu/courseuide/course/6/fa08/index.xml

This file lists each subject in the Course and information about
subjects such as title, instructors, time, location, and description.
Below is the DTD for this file as of May 2008::

  <?xml version="1.0" encoding="UTF-8"?>
  <!--DTD generated by XMLSpy v2008 rel. 2 (http://www.altova.com)-->
  <!ELEMENT title (#PCDATA)>
  <!ELEMENT termName (#PCDATA)>
  <!ELEMENT term (#PCDATA | term | termName | subjects)*>
  <!ATTLIST term
  	id CDATA #FIXED "sp08"
  >
  <!ELEMENT tas ((fullName+))>
  <!ELEMENT subjects ((subject+))>
  <!ELEMENT subjectId (#PCDATA)>
  <!ELEMENT subject ((name, title, subjectId, masterSubjectId, stellarSites?, description))>
  <!ELEMENT stellarUrl (#PCDATA)>
  <!ELEMENT stellarTitle (#PCDATA)>
  <!ELEMENT stellarSites ((stellarSite+))>
  <!ELEMENT stellarSite ((stellarUrl, stellarTitle, staff))>
  <!ELEMENT staff ((instructors, tas?))>
  <!ELEMENT name (#PCDATA)>
  <!ELEMENT masterSubjectId (#PCDATA)>
  <!ELEMENT instructors ((fullName+))>
  <!ELEMENT fullName (#PCDATA)>
  <!ELEMENT description (#PCDATA)>
  <!ELEMENT department (#PCDATA)>
  <!ELEMENT courseTerm ((course, term))>
  <!ELEMENT course ((department))>


Each subject has an RSS feed for public announcements. The URL for the
subject “2.705” for the Summer 2009 term, for example, is
http://stellar.mit.edu/SRSS/rss/course/2/su09/2.705/


-----------
Logic Files
-----------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/announcement.php
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Only relevant for Basic pages.  Reached by clicking the "more" link on
a truncated announcement from the list of announcements in the detail
page on a Basic device.  Retrieves the full text of a single
announcement and populates the template
``mobi-web/stellar/Basic/announcement.html``.  Creates a PHP session
variable to keep track of the class being viewed.

^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/course.php
^^^^^^^^^^^^^^^^^^^^^^^^^^^

^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/courses.php
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Drill down list for a sublist of all Courses (1-10, 11-20, 21-24, and
others).

^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/detail.php
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Subject detail page.  Populates content for three tabs: Announcements,
Info, and Staff, from the ``StellarData`` class.

Provides convenience functions for creating URL links that open other
modules (people directory and campus map).

^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/search.php
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Calls ``StellarData::search_subjects()`` on the search string entered
in the search form and creates a new ``ResultsContent`` object that
will render the results of the search.

If exactly one result is returned from the search, the user is
redirected to the detail page.

^^^^^^^^^^^^^^^^^^^^^^^^
mobi-lib/StellarData.php
^^^^^^^^^^^^^^^^^^^^^^^^

.. class:: StellarData

Singleton class providing interface to Stellar XML and RSS feeds,
reads and caches data from the Stellar server.  Provides methods to
get a list of Courses, subjects under a Course, and details about a
subject.

Additionally provides methods linked to the subscription system for
native app notifications.

Contains a list of hard-coded Course numbers and titles.  We do not
currently know of an external source that provides all these data in
one place.

.. method:: StellarData::get_courses()

Returns a list of all Courses with titles.  For general programs that
are not Courses, the flag ``is_course`` is set to a false value.

.. method:: StellarData::get_others()

Returns a list of Courses whose ID's are not numerical.

.. method:: StellarData::get_subjects($course)

Returns a list of all subjects in the Course ``$course``.  No extra work
is done for subjects that are cross-listed.

.. method:: StellarData::get_subjects_with_xref($course)

Returns a list of all subjects in the Course ``$course``.  For subjects
that are cross-listed, subject details are retrieved for the subject's
master ID.

.. method:: StellarData::get_subject_id($id)

Returns the masterID of the subject listed as ``$id``.

.. method:: StellarData::get_subject_info($id)

Returns detail information about the subject listed as ``$id``.  If
this is not the master ID, detail information is retrieved from the
subject that is this subject's master ID.

.. method:: StellarData::get_announcements($id)

Returns latest public announcements for the subject ``$id``.

.. method:: StellarData::search_subjects($terms)

Searches by Course number if the search term matches a Course ID,
otherwise searches subject titles such that all search tokens are
included.

.. method:: StellarData::check_subscriptions($term)

.. method:: StellarData::subjects_with_subscriptions($term)

.. method:: StellarData::subscriptions_for_subject($subject, $term)

.. method:: StellarData::push_subscribe($subject, $term, $device_id, $device_type)

.. method:: StellarData::push_unsubscribe($subject, $term, $device_id, $device_type)


^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/index.php
^^^^^^^^^^^^^^^^^^^^^^^^^^

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/stellar_lib.php
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


--------------
Template Files
--------------

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/index.html
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Displays top-level links to drill down to a sublist of courses, a
search bar to search for subjects by title, and any My Stellar
subjects that have been bookmarked.


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/course.html
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/courses.html
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/detail.html
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/items.html
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/mystellar.\*
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
mobi-web/stellar/\*/search.html
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
